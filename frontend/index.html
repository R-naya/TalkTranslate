<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <title>TalkTranslate</title>
    </head>
    <body>
        <h1>TalkTranslate</h1>

        <p>Entrez un texte à traduire :</p>

        <input type="text" id="textInput" placeholder="Ex : bonjour">
        <select id="languageSelect">
            <option value="en">Anglais</option>
            <option value="es">Espagnol</option>
            <option value="de">Allemand</option>
        </select>

        <button id="translateButton">Traduire</button>

        <h2>Résultat :</h2>
        <p><strong>Transcription :</strong> <span id="transcription"></span></p>
        <p><strong>Traduction :</strong> <span id="translation"></span></p>

        <hr>

        <h2>Capture audio (test)</h2>
        <button id="recordButton">Démarrer l'enregistrement</button>

        <script>
            const translateButton = document.getElementById("translateButton");

            translateButton.addEventListener("click", () => {
                const text = document.getElementById("textInput").value;
                const lang = document.getElementById("languageSelect").value;

                fetch("http://127.0.0.1:5000/process", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        text: text,
                        target_lang: lang
                    })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("transcription").textContent = data.transcription;
                    document.getElementById("translation").textContent = data.translated;
                })
                .catch(error => {
                        console.error("Erreur :", error);
                });
            });

            const recordButton = document.getElementById("recordButton");
            let mediaRecorder = null;

            recordButton.addEventListener("click", async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true});
                    console.log("Accès au micro autorisé");

                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();

                    console.log("Enregistrement démarré");

                    setTimeout(() => {
                        mediaRecorder.stop();
                        console.log("Enregistrement arrêté");
                    }, 3000);
                } catch (err) {
                    console.error("Erreur accès micro :", err);
                }
            });
        </script>
    </body>
</html>